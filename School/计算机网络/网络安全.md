---
typora-copy-images-to: ..\..\img
---

# 网络安全

[一个故事讲完Https](https://mp.weixin.qq.com/s/StqqafHePlBkWAPQZg3NrA?)

[HTTPS的创建过程](https://blog.csdn.net/xiaoming100001/article/details/81109617)

安全的网络通信要解决一下几个问题：

1. 机密性，报文需要加密

   先使用非对称密钥传送对称密钥，再使用对称密钥进行报文的加解密操作

2. 报文完整性，检查报文是否经过篡改(使用散列函数+鉴别密钥)

   - 报文鉴别码：对于报文m，使用散列函数得到h(m)，发送(m,h(m)),但可能第三者同时修改m和h(m)，所以加上鉴别密钥s，发送(m,h(m+s)),h(m+s)也叫做报文鉴别码。对于，ssl建立成功后，传输的主体数据使用这种机制

   - 数字签名：对长报文使用散列函数，得到固定长度的散列值(数字摘要)。Alice使用自己的密钥对其加密，连同报文一起发送给Bob(m,k-(h(m)))，Bob收到之后使用A的公钥对其解密，k+k-(h(m))，在使用相同的hash算法对收到的报文进行散列计算，判断结果是否和h(m)相等，如果相等，说明该报文一定是Alice发的。(用于CA)

   区别:

   MAC机制不需要加密解密，性能高，但不能验证对方的身份，因此适合ssl建立成功后，传输的主体数据使用这种机制。

   数字签名：数据需要用私钥加密，能鉴别数据确实由发送方发送，性能低，用于数字证书认证。

   

3. 端点鉴别，确认通信对方的身份

   不重数：

   1. Alice向Bob发送报文:我是Alice
   2. Bob向Alice发送一个很长时间内都不会再使用的数字R
   3. Alice使用和Bob共享的对称密钥进行加密，发送给Bob
   4. Bob解密后判断是否等于R

4. 运行安全性，防火墙。。



HTTPS的三个工作：

1. 内容加密：采用混合加密技术，中间者无法直接查看明文内容
2. 验证身份：通过证书认证客户端访问的是自己的服务器
3. 保护数据完整性：防止传输的内容被中间人冒充或者篡改

![1567652825905](..\..\img\1567652825905.png)



## SSL建立连接过程

![1567657316090](..\..\img\1567657316090.png)

1. client向server发送请求https://baidu.com，然后连接到server的443端口，发送的信息主要是随机值1和客户端支持的加密算法。
2. server接收到信息之后给予client响应握手信息，包括随机值2和匹配好的协商加密算法，这个加密算法一定是client发送给server加密算法的子集。
3. 随即server给client发送第二个响应报文是数字证书。服务端必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面，这套证书其实就是一对公钥和私钥。传送证书，这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构，过期时间、服务端的公钥，第三方证书认证机构(CA)的签名，服务端的域名信息等内容。
4. 客户端解析证书，这部分工作是由客户端的TLS来完成的，首先会验证公钥是否有效，比如颁发机构，过期时间等等，如果发现异常，则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随即值（预主秘钥）。
5. 客户端认证证书通过之后，接下来是通过随机值1、随机值2和预主秘钥组装会话秘钥。然后通过证书的公钥加密会话秘钥。
6. 传送加密信息，这部分传送的是用证书加密后的会话秘钥，目的就是让服务端使用秘钥解密得到随机值1、随机值2和预主秘钥。
7. 服务端解密得到随机值1、随机值2和预主秘钥，然后组装会话秘钥，跟客户端会话秘钥相同。
   客户端通过会话秘钥加密一条消息发送给服务端，主要验证服务端是否正常接受客户端加密的消息。
8. 客户发送所以握手报文的MAC
9. 服务端发送所有握手报文的MAC