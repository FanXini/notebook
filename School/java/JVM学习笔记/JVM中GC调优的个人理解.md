1. jvm中GC采用分代算法，分为新生代，老年代和永久代，不同的年龄代采用不同的回收算法
2. 因为新生代的对象很多都是一些局部变量，使用过一次之后就不再使用了，所以，每次80%的对象都要被回收掉，根据这种特性，jvb采用的是复制的算法——预留一部内存A，只使用内存B，B中的内存不够用时，触发minor-GC,将未被回收的对象复制到A中，这种算法不存在碎片化的现象，且复制的对象少，速度快。
3. 而老生代的对象生命周期场，Full Gc后存活的对象多，因此，使用复制算法的话需要预留很大的一部分内存存放未被回收的对象，这样使用率很低。因此jvm通常使用标志-清除(CMS)和标志整理的(serialOld.parallelOld)算法()



## 区别：

看起来同一个区域的算法使用的回收算法都差不多，但区别在于，他们使用的是串行、并行还是并发的算法。

- 串行：需要暂停所有的用户线程，只有一个GC线程进行垃圾回收,使用于单核的CPU。
- 并行：多条线程同时进行GC,但也要暂停用户线程
- 并发：GC线程可以和用户线程同时运行，但是内存整理的时候没办法并发

## 怎么选取？

- 如果电脑是单核CPU,那建议使用串行算法，因为没有线程上下文切换的开销，GC线程专心做垃圾回收的工作。

- 吞吐量要求大的电脑：吞吐量:用户线程运行的时间/(用户线程运行的时间+GC时间)

  这种情况使用并行的算法，多条GC线程同时进行垃圾回收，将GC的时间降低

- 响应时间优先

  要求用户任务的执行时间很快，那就要尽量减少stop the world的时间，因此应该使用并发的算法。虽然GC的时间长了一点，但是可以保证用户线程的执行速度不会降低太多。

  

## GC调优总结

年轻代的选择：

- 响应时间优先的应用：尽可能设大，直到接近系统的最低响应时间限制。在这种情况下，年轻代发生minorGC的频率也是最小的。同时，减少到达老年代的对象。
- 吞吐量优先的应用：尽可能地设置大，可能达到Gbit的程度。因为对响应时间没有要求，垃圾收集可以并行运行，一般适合8CPU以上的应用。

老年代的选择

- 响应时间优先的应用：老年代使用并发收集器，所以其大小需要小心设置，一般要考虑并发会话率和会话持续时间等一些参数。如果堆设置小了，可能会造成内存碎片，高回收频率以及应用暂停而使用传统的标记清除方式；如果堆设置大了，则需要较长的收集时间。最优化的方案，一般需要参考以下数据获得：

  1. 并发垃圾收集信息
  2. 持久代并发收集次数
  3. 传统GC信息
  4. 花在年轻代和年老代回收上的时间比例
     减少年轻代和年老代花费的时间，一般会提高应用的效率

- 吞吐量优先的应用

  一般吞吐量优先的应用都有一个很大的年轻代和一个较小的年老代。原因是，这样可以尽可能回收掉大部分短期对象，减少中期的对象，而年老代尽存放长期存活对象。

- 较小堆引起的碎片问题

  因为年老代的并发收集器使用标记、清除算法，所以不会对堆进行压缩。当收集器回收时，他会把相邻的空间进行合并，这样可以分配给较大的对象。但是，当堆空间较小时，运行一段时间以后，就会出现“碎片”，如果并发收集器找不到足够的空间，那么并发收集器将会停止，然后使用传统的标记、清除方式进行回收。如果出现“碎片”，可能需要进行如下配置：
  1. -XX:+UseCMSCompactAtFullCollection：使用并发收集器时，开启对年老代的压缩。
  2. -XX:CMSFullGCsBeforeCompaction=0：上面配置开启的情况下，这里设置多少次Full GC后，对年老代进行压缩

## 常见配置汇总

栈设置

-Xss 线程栈空间大小

堆设置
-Xms:初始堆大小
-Xmx:最大堆大小
-XX:NewSize=n:设置年轻代大小
-XX:NewRatio=n:设置年轻代和年老代的比值。如:为3，表示年轻代与年老代比值为1：3，年轻代占整个年轻代年老代和的1/4
-XX:SurvivorRatio=n:年轻代中Eden区与两个Survivor区的比值。注意Survivor区有两个。如：3，表示Eden：Survivor=3：2，一个Survivor区占整个年轻代的1/5
-XX:MaxPermSize=n:设置持久代大小

收集器设置
-XX:+UseSerialGC:设置串行收集器
-XX:+UseParallelGC:设置并行收集器
-XX:+UseParalledlOldGC:设置并行年老代收集器
-XX:+UseConcMarkSweepGC:设置并发收集器

垃圾回收统计信息
-XX:+PrintGC
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-Xloggc:filename

并行收集器设置
-XX:ParallelGCThreads=n:设置并行收集器收集时使用的CPU数。并行收集线程数。
-XX:MaxGCPauseMillis=n:设置并行收集最大暂停时间
-XX:GCTimeRatio=n:设置垃圾回收时间占程序运行时间的百分比。公式为1/(1+n)

并发收集器设置
-XX:+CMSIncrementalMode:设置为增量模式。适用于单CPU情况。
-XX:ParallelGCThreads=n:设置并发收集器年轻代收集方式为并行收集时，使用的CPU数。并行收集线程数。

